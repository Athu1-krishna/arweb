<!DOCTYPE html>
<html>
<head>
  <title>AR multi-marker video</title>
  <meta name="viewport" content="width=device-width,height=device-height">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">

  <!-- a-frame + ar.js -->
  <script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
  <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.5.5/aframe/build/aframe-ar.js"></script>

  <script>
    // Component that accepts a selector to pick the video for this marker
    AFRAME.registerComponent('video-vidhandler', {
      schema: {
        src: { type: 'selector' } // pass in e.g. src: #video1
      },

      init: function () {
        this.toggle = false;
        this.vid = this.data.src; // will be the actual <video> element
        if (!this.vid) {
          console.warn('video-vidhandler: no video found for', this.el);
          return;
        }
        // Pause initially
        try { this.vid.pause(); } catch (e) {}
      },

      tick: function () {
        if (!this.vid) return;
        // if marker visible -> play; else pause
        if (this.el.object3D.visible === true) {
          if (!this.toggle) {
            this.toggle = true;
            // attempt to play and catch autoplay exceptions
            this.vid.play().catch(function (err) {
              console.warn('Video play failed (autoplay policy) â€” try muted or user gesture', err);
            });
          }
        } else {
          this.toggle = false;
          try { this.vid.pause(); } catch (e) {}
        }
      }
    });
  </script>
</head>

<body>
  <a-scene id="scene" arjs="trackingMethod: best; debugUIEnabled: false;" vr-mode-ui="enabled: false">

    <a-assets>
      <!-- video 1 -->
      <video id="video1"
             preload="auto"
             loop="false"
             muted        
             playsinline webkit-playsinline
             crossorigin="anonymous"
             playsinline controls>
        <source src="videos/vid1.mp4" type="video/mp4">
      </video>

      <!-- video 2 -->
      <video id="video2"
             preload="auto"
             loop="false"
             muted
             playsinline webkit-playsinline
             crossorigin="anonymous"
             playsinline controls>
        <source src="videos/mov_bbb.mp4" type="video/mp4">
      </video>
    </a-assets>

    <!-- marker 1 uses video1 -->
    <a-marker id="marker1"
              type="pattern"
              url="markers/marker1.patt"
              video-vidhandler="src: #video1">

      <a-plane scale="4 2"
               position="0 0.1 0"
               rotation="-90 0 0"
               material="transparent:true;src:#video1"
               ></a-plane>
    </a-marker>

    <!-- marker 2 uses video2 -->
    <a-marker id="marker2"
              type="pattern"
              url="markers/pattern-ref2.patt"
              video-vidhandler="src: #video2">

      <a-plane scale="4 2"
               position="0 0.1 0"
               rotation="-90 0 0"
               material="transparent:true;src:#video2"
               ></a-plane>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>
</body>
</html>
